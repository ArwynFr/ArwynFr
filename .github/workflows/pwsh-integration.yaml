name: continuous integration

on:
  workflow_call:
    inputs:
      tests:
        description: Path to a script that runs unit tests and coverage report
        required: true
        type: string
      coverage:
        description: Path to the coverage file generated by test script
        default: coverage.xml
        required: false
        type: string
    secrets:
      CODACY_PROJECT_TOKEN:
        required: true

jobs:
  integration:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout source files
        uses: actions/checkout@v3

      - shell: pwsh
        name: Run unit tests
        run: ${{ inputs.tests }}

      - name: Run Codacy coverage reporter
        uses: codacy/codacy-coverage-reporter-action@v1
        with:
          project-token: ${{ secrets.CODACY_PROJECT_TOKEN }}
          coverage-reports: ${{ inputs.coverage }}
